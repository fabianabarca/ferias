{% extends 'base.html' %}

{% load static %}

{% block page_title %} Crear una receta {% endblock %}

{% block bg-navbar %} background-amarillo {% endblock %}

{% block main %}

<div class="container my-5">
    <h1 class="mb-4">Crear una receta</h1>

    <form
        action="{% if recipe.slug %}{% url 'edit_recipe' recipe.slug %}{% else %}{% url 'create_recipe' %}{% endif %}"
        method="post"
        enctype="multipart/form-data"
        class="card p-4"
    > <!-- Si la receta tiene un slug, significa que la mandaron por context y debe usarse el form editar. Si no, es el form de crear receta. -->
        {% csrf_token %}

        <div class="form-group mb-3">
            <div class="form-data">Nombre de la receta</div>
            <div class="form-data">{{ recipe_form.name }}</div>
        </div>
        <div class="form-group mb-3">
            <div class="form-data">Decripción</div>
            <div class="form-data">{{ recipe_form.description }}</div>
        </div>
        <div class="form-group mb-3">
            <div class="form-data">Categoría</div>
            <div class="form-data">{{ recipe_form.category }}</div>
        </div>
        <div class="form-group mb-3">
            <div class="form-data">Etiquetas</div>
            <div class="form-data">{{ recipe_form.tags }}</div>
        </div>
        <!-- TODO: Que se le pueda agregar una imagen a una receta. -->

        <!-- TODO: Aquí la idea es que también se puedan agregar ingredientes que no estén ya en la lista de ingredientes que se despliega.
            Para eso se debería poder crear un nuevo ingrediente en el form. 
        -->
        <h3>Ingredientes</h3>
        <div id="ingredients-container">
            {{ ingredient_formset.management_form }}
            {% for form in ingredient_formset %}
            <div class="ingredient-row mb-3">
                {{ form.as_p }}
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-danger btn-sm remove-ingredient">Quitar</button>
                <button type="button" class="btn btn-primary btn-sm" id="add-ingredient">Agregar ingrediente</button>
            </div>
            {% endfor %}
        </div>
        <div class="ingredient-row mb-3">
            <h5 class="mb-3">Lista de ingredientes agregados</h5>
            <div class="mb-3">
                <button type="button" class="btn btn-danger btn-sm remove-ingredient">Quitar</button>
            </div>
        </div>

        <!-- TODO: Que el usuario pueda ver los pasos recientemente agregados. -->
        <h3>Pasos</h3>
        <div id="steps-container">
            {{ step_formset.management_form }}
            {% for form in step_formset %}
            <div class="step-row mb-3">
                {{ form.as_p }}
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-danger btn-sm remove-step">Quitar</button>
                <button type="button" class="btn btn-primary btn-sm" id="add-step">Agregar paso</button>
            </div>
            {% endfor %}
            <div class="step-row mb-3">
                <h5 class="mb-3">Lista de pasos agregados</h5>
                <div class="mb-3">
                    <button type="button" class="btn btn-danger btn-sm remove-step">Quitar</button>
                </div>
            </div>
        </div>
        

        <button type="submit" class="btn btn-success">Guardar receta</button>
    </form>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{% static 'formset/jquery.formset.js' %}"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        var addIngredientButton = document.getElementById('add-ingredient');
        var ingredientsContainer = document.getElementById('ingredients-container');

        addIngredientButton.addEventListener('click', function() {
            var newForm = '{{ ingredient_formset.empty_form.as_p }}';
            var div = document.createElement('div');
            div.classList.add('ingredient-row', 'mb-3');
            div.innerHTML = newForm;
            div.querySelector('button.remove-ingredient').addEventListener('click', function() {
                div.remove();
            });
            ingredientsContainer.appendChild(div);
        });
    });
</script>


{% endblock %}